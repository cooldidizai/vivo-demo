<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小红书数据清洗与拟合推算规则说明 - Project 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; background-color: #f8f9fa; }
        .card { transition: all 0.3s ease; }
        .card:hover { transform: translateY(-2px); shadow: lg; }
        .keyword-tag { background: rgba(255, 36, 66, 0.1); color: #ff2442; border: 1px solid rgba(255, 36, 66, 0.2); }
        .formula-box { background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%); color: white; }
        /* 日历样式 */
        .cal-day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 12px; cursor: pointer; transition: 0.2s; position: relative;}
        .cal-day:hover { transform: scale(1.1); z-index: 10; border: 2px solid #333; }
        .type-workday { background-color: #e2e8f0; color: #475569; }
        .type-weekend { background-color: #dbeafe; color: #1e40af; }
        .type-holiday { background-color: #ffedd5; color: #9a3412; }
        .type-cny { background-color: #fee2e2; color: #991b1b; font-weight: bold; border: 1px solid #ef4444; }
    </style>
</head>
<body class="text-gray-800">

    <!-- 顶部导航 -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <i class="fa-solid fa-database text-red-500 text-xl mr-3"></i>
                    <span class="font-bold text-xl text-gray-900">小红书数据推算 <span class="text-xs bg-gray-200 px-2 py-1 rounded ml-2">2026</span></span>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-500">演示用</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- 第一部分：核心问题与公式 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <div class="lg:col-span-2 bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fa-solid fa-calculator text-blue-500 mr-2"></i> 数据校准公式逻辑
                </h2>
                <p class="text-sm text-gray-600 mb-4">
                    由于小红书平台数据存在显著的<b>“节假日波动”</b>（如春节、周末发帖量自然下降），直接使用采集数据无法判断是品牌声量下跌还是平台大盘下跌。
                    <br>我们需要引入<b>“常规词大盘数据表现”</b>作为校准系数。
                </p>
                
                <div class="formula-box rounded-lg p-6 shadow-inner relative overflow-hidden">
                    <div class="absolute top-0 right-0 opacity-10 text-9xl">ƒ</div>
                    <div class="text-center">
                        <div class="text-sm opacity-80 mb-2">vivo 真实声量指数 (拟合值) =</div>
                        <div class="flex items-center justify-center text-xl md:text-2xl font-mono font-bold">
                            <div class="flex flex-col">
                                <span class="border-b-2 border-white pb-1">26年 vivo 关键词当日采集量</span>
                                <div class="text-sm font-normal mt-1 opacity-90">
                                    (26年常规词当日量 / 24年同类型日期均值)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-4 grid grid-cols-3 gap-4 text-center text-xs">
                    <div class="p-2 bg-gray-50 rounded">
                        <div class="font-bold text-gray-700">分子：业务数据</div>
                        <div class="text-gray-500">实际采集到的品牌/机型声量</div>
                    </div>
                    <div class="p-2 bg-gray-50 rounded">
                        <div class="font-bold text-blue-600">分母：流量系数</div>
                        <div class="text-gray-500">当日大盘热度相对于历史均值的倍数</div>
                    </div>
                    <div class="p-2 bg-gray-50 rounded">
                        <div class="font-bold text-green-600">结果：去噪数据</div>
                        <div class="text-gray-500">剔除节假日影响后的真实趋势</div>
                    </div>
                </div>
            </div>

            <!-- 常规词展示 -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <i class="fa-solid fa-tags text-red-500 mr-2"></i> 常规词基准
                </h2>
                <p class="text-xs text-gray-500 mb-3">选取高频、无品牌倾向的情绪/生活类词汇代表平台自然流量。</p>
                <div class="flex flex-wrap gap-2" id="keywords-container">
                    <!-- JS 生成关键词 -->
                </div>
            </div>
        </div>

        <!-- 第二部分：2024年历史基准数据 -->
        <div class="mb-8">
            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                <i class="fa-solid fa-history text-gray-500 mr-2"></i> 2024年历史基准线 (分母参数)
            </h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-gray-400">
                    <div class="text-gray-500 text-xs uppercase font-bold">工作日均值 (Workday)</div>
                    <div class="text-2xl font-bold text-gray-800 mt-1">1,578,040</div>
                    <div class="text-xs text-gray-400 mt-1">基准: 100%</div>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-blue-500">
                    <div class="text-gray-500 text-xs uppercase font-bold">周末均值 (Weekend)</div>
                    <div class="text-2xl font-bold text-blue-600 mt-1">1,499,617</div>
                    <div class="text-xs text-red-500 mt-1"><i class="fa-solid fa-arrow-down"></i> 约95% (工作日)</div>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-orange-400">
                    <div class="text-gray-500 text-xs uppercase font-bold">节假日均值 (Holiday)</div>
                    <div class="text-2xl font-bold text-orange-600 mt-1">1,367,090</div>
                    <div class="text-xs text-red-500 mt-1"><i class="fa-solid fa-arrow-down"></i> 约86% (工作日)</div>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-red-600">
                    <div class="text-gray-500 text-xs uppercase font-bold">春节均值 (CNY)</div>
                    <div class="text-2xl font-bold text-red-600 mt-1">930,422</div>
                    <div class="text-xs text-red-500 mt-1"><i class="fa-solid fa-arrow-down"></i> 仅59% (工作日)</div>
                </div>
            </div>
        </div>

        <!-- 第三部分：2026年推算模拟器 -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-lg font-bold flex items-center">
                    <i class="fa-regular fa-calendar-check text-green-600 mr-2"></i> 2026年全景推算模拟
                </h2>
                <div class="flex gap-4 text-xs">
                    <span class="flex items-center"><span class="w-3 h-3 bg-gray-200 mr-1 rounded"></span>工作日</span>
                    <span class="flex items-center"><span class="w-3 h-3 bg-blue-100 mr-1 rounded"></span>周末</span>
                    <span class="flex items-center"><span class="w-3 h-3 bg-orange-100 mr-1 rounded"></span>节假日</span>
                    <span class="flex items-center"><span class="w-3 h-3 bg-red-100 border border-red-400 mr-1 rounded"></span>春节</span>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- 左侧：交互式日历 -->
                <div class="lg:col-span-7">
                    <div class="flex justify-between items-center mb-2">
                        <button onclick="changeMonth(-1)" class="px-3 py-1 bg-gray-100 rounded hover:bg-gray-200 text-xs">◀ 上个月</button>
                        <span id="currentMonthLabel" class="font-bold">2026年 1月</span>
                        <button onclick="changeMonth(1)" class="px-3 py-1 bg-gray-100 rounded hover:bg-gray-200 text-xs">下个月 ▶</button>
                    </div>
                    <div class="grid grid-cols-7 gap-2 text-center text-xs font-bold text-gray-400 mb-2">
                        <div>一</div><div>二</div><div>三</div><div>四</div><div>五</div><div>六</div><div>日</div>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-2">
                        <!-- JS 生成日历格子 -->
                    </div>
                </div>

                <!-- 右侧：详情与计算面板 -->
                <div class="lg:col-span-5 bg-gray-50 rounded-lg p-5 border border-gray-200">
                    <div id="calculator-panel">
                        <div class="mb-4 pb-4 border-b border-gray-200">
                            <span class="text-xs text-gray-500">选中日期</span>
                            <h3 class="text-2xl font-bold" id="selected-date">请选择左侧日期</h3>
                            <div class="mt-2 inline-block px-2 py-1 rounded text-xs font-bold bg-gray-200 text-gray-600" id="selected-type">
                                待定
                            </div>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-xs font-bold text-gray-700 mb-1">模拟：26年常规词当日发帖</label>
                                <input type="number" id="input-general" class="w-full p-2 border rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none" value="1000000">
                                <p class="text-xs text-gray-400 mt-1">输入当日大盘监测数据</p>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-gray-700 mb-1">模拟：26年Vivo当日发帖 (异常/原始)</label>
                                <input type="number" id="input-vivo" class="w-full p-2 border rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none" value="5000">
                            </div>

                            <div class="bg-blue-50 p-4 rounded border border-blue-100 mt-4">
                                <div class="flex justify-between items-end mb-1">
                                    <span class="text-sm font-bold text-blue-900">拟合校准后声量</span>
                                    <span class="text-2xl font-bold text-blue-600" id="result-value">---</span>
                                </div>
                                <div class="text-xs text-blue-400 border-t border-blue-200 pt-2 mt-2" id="calculation-logic">
                                    计算过程将在此显示
                                </div>
                            </div>
                            
                            <div class="text-xs text-gray-500 mt-2 bg-yellow-50 p-2 rounded border border-yellow-100">
                                <i class="fa-solid fa-lightbulb text-yellow-500"></i> 
                                <b>规则解读：</b> 如果选了春节日期，分母(基准均值)会变小。若常规词输入量也很小(符合春节特征)，则系数接近1，校准后声量接近原始值。若常规词量异常高，说明平台热度高，校准后Vivo声量会相对下调。
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // 1. 基础数据定义
        const keywords = "我们|你们|他们|她们|姐妹|家人们|宝子们|悲伤|难过|开心|快乐|emo|破防|治愈|下头|推荐|种草|安利|避雷|翻车|绝绝子|yyds|真的|超级".split("|");
        
        // 2024年均值 (根据之前的计算)
        const means = {
            workday: 1578040,
            weekend: 1499617,
            holiday: 1367090,
            cny: 930422
        };

        // 2026年特殊日期定义 (基于用户提供的图片逻辑)
        // 格式: M-D
        const holidays2026 = [
            "1-1", "1-2", "1-3", // 元旦
            "4-4", "4-5", "4-6", // 清明
            "5-1", "5-2", "5-3", "5-4", "5-5", // 劳动节
            "6-19", "6-20", "6-21", // 端午
            "9-25", "9-26", "9-27", // 中秋
            "10-1", "10-2", "10-3", "10-4", "10-5", "10-6", "10-7" // 国庆
        ];
        
        const cny2026 = [
            "2-15", "2-16", "2-17", "2-18", "2-19", "2-20", "2-21", "2-22", "2-23"
        ];

        // 调休上班 (原本是周末，但变成了工作日)
        const makeupWorkdays = [
            "1-4", // 周日上班
            "2-14", "2-28", // 周六上班
            "5-9", // 周六上班
            "9-20", // 周日上班
            "10-10" // 周六上班
        ];

        let currentYear = 2026;
        let currentMonth = 1; // 1-12
        let selectedDateData = null;

        // 2. 初始化关键词标签
        const kwContainer = document.getElementById('keywords-container');
        keywords.forEach(kw => {
            const span = document.createElement('span');
            span.className = 'keyword-tag px-2 py-1 rounded text-xs font-medium';
            span.innerText = kw;
            kwContainer.appendChild(span);
        });

        // 3. 日历逻辑
        function getDayType(year, month, day) {
            const dateStr = `${month}-${day}`;
            const dateObj = new Date(year, month - 1, day);
            const dayOfWeek = dateObj.getDay(); // 0 is Sunday

            // 优先级 1: 春节
            if (cny2026.includes(dateStr)) return { type: 'cny', label: '春节', mean: means.cny };

            // 优先级 2: 节假日
            if (holidays2026.includes(dateStr)) return { type: 'holiday', label: '节假日', mean: means.holiday };

            // 优先级 3: 补班 (强制工作日)
            if (makeupWorkdays.includes(dateStr)) return { type: 'workday', label: '工作日(调休)', mean: means.workday };

            // 优先级 4: 周末
            if (dayOfWeek === 0 || dayOfWeek === 6) return { type: 'weekend', label: '周末', mean: means.weekend };

            // 默认: 工作日
            return { type: 'workday', label: '工作日', mean: means.workday };
        }

        function renderCalendar(month) {
            const grid = document.getElementById('calendar-grid');
            grid.innerHTML = '';
            document.getElementById('currentMonthLabel').innerText = `2026年 ${month}月`;

            const firstDay = new Date(currentYear, month - 1, 1).getDay(); // 0-6
            const daysInMonth = new Date(currentYear, month, 0).getDate();
            
            // 调整周一为开始 (JS默认周日为0)
            let startOffset = firstDay === 0 ? 6 : firstDay - 1;

            // 填充空白
            for (let i = 0; i < startOffset; i++) {
                const blank = document.createElement('div');
                grid.appendChild(blank);
            }

            // 填充日期
            for (let d = 1; d <= daysInMonth; d++) {
                const dayData = getDayType(currentYear, month, d);
                const cell = document.createElement('div');
                cell.className = `cal-day type-${dayData.type}`;
                cell.innerHTML = `<span>${d}</span>`;
                
                // 默认选择2月15日演示春节
                if(month === 2 && d === 15 && !selectedDateData) {
                   setTimeout(() => selectDate(currentYear, month, d, dayData), 100);
                }

                cell.onclick = () => selectDate(currentYear, month, d, dayData);
                grid.appendChild(cell);
            }
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 12) currentMonth = 1;
            if (currentMonth < 1) currentMonth = 12;
            renderCalendar(currentMonth);
        }

        // 4. 计算交互逻辑
        function selectDate(y, m, d, data) {
            selectedDateData = { ...data, date: `${y}/${m}/${d}` };
            
            // UI 更新
            document.getElementById('selected-date').innerText = selectedDateData.date;
            
            const typeBadge = document.getElementById('selected-type');
            typeBadge.innerText = data.label;
            typeBadge.className = `mt-2 inline-block px-2 py-1 rounded text-xs font-bold `;
            
            if(data.type === 'cny') typeBadge.classList.add('bg-red-100', 'text-red-800');
            else if(data.type === 'holiday') typeBadge.classList.add('bg-orange-100', 'text-orange-800');
            else if(data.type === 'weekend') typeBadge.classList.add('bg-blue-100', 'text-blue-800');
            else typeBadge.classList.add('bg-gray-200', 'text-gray-600');

            // 自动填入一些模拟数据以展示效果
            if (data.type === 'cny') {
                document.getElementById('input-general').value = 800000; // 春节大盘低
            } else {
                document.getElementById('input-general').value = 1600000; // 平时大盘高
            }
            
            calculate();
        }

        function calculate() {
            if (!selectedDateData) return;

            const general26 = parseFloat(document.getElementById('input-general').value) || 0;
            const vivo26 = parseFloat(document.getElementById('input-vivo').value) || 0;
            const baseline24 = selectedDateData.mean;

            // 核心公式
            // 拟合 = Vivo26 / (General26 / Baseline24)
            // 即: Vivo26 * Baseline24 / General26
            
            if (general26 === 0) {
                document.getElementById('result-value').innerText = "错误(除数为0)";
                return;
            }

            const coefficient = general26 / baseline24;
            const result = vivo26 / coefficient;

            // 格式化数字
            const fmt = (num) => num.toLocaleString('en-US', {maximumFractionDigits: 0});
            const fmtDec = (num) => num.toLocaleString('en-US', {maximumFractionDigits: 4});

            document.getElementById('result-value').innerText = fmt(result);
            document.getElementById('calculation-logic').innerHTML = `
                <div class="flex flex-col gap-1">
                    <div>1. 流量系数 = <span class="text-gray-600">${fmt(general26)}</span> / <span class="text-gray-600">${fmt(baseline24)}</span> = <b>${fmtDec(coefficient)}</b></div>
                    <div>2. 拟合声量 = <span class="text-gray-600">${fmt(vivo26)}</span> / <b>${fmtDec(coefficient)}</b> = <b>${fmt(result)}</b></div>
                </div>
            `;
        }

        // 监听输入
        document.getElementById('input-general').addEventListener('input', calculate);
        document.getElementById('input-vivo').addEventListener('input', calculate);

        // 初始化
        renderCalendar(2); // 默认展示2月（春节）

    </script>
</body>
</html>
